# Ragify Docker Compose Configuration
#
# Usage:
#   1. Copy docker/users.yaml.example to users.yaml
#   2. Add your GitHub username to users.yaml
#   3. Create a GitHub OAuth App (https://github.com/settings/developers)
#   4. Set environment variables in .env or export them:
#      - GITHUB_CLIENT_ID
#      - GITHUB_CLIENT_SECRET
#   5. Run: docker compose up -d
#
# Access: http://localhost:8080

services:
  ragify:
    build:
      context: .
      dockerfile: Dockerfile
    image: ragify:latest
    container_name: ragify
    ports:
      - "${API_PORT:-8080}:8080"
      - "${MCP_PORT:-6666}:6666"
    volumes:
      # Persistent data for Qdrant
      - ragify_data:/data
      # Users configuration (required for auth)
      - ./users.yaml:/config/users.yaml:ro
      # Optional: HTTPS certificates
      # - ./certs:/certs:ro
    environment:
      # Authentication
      - AUTH_CONFIG=/config/users.yaml
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - BASE_URL=${BASE_URL:-http://localhost:8080}
      # Ports (internal, usually don't change)
      - API_PORT=8080
      - MCP_PORT=6666
      # Ollama model (default: nomic-embed-text)
      - OLLAMA_MODEL=${OLLAMA_MODEL:-nomic-embed-text}
      # Optional: HTTPS
      # - SSL_CERT=/certs/cert.pem
      # - SSL_KEY=/certs/key.pem
      # Optional: Webhook notifications
      # - WEBHOOK_URL=${WEBHOOK_URL}
    restart: unless-stopped
    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          memory: 8G
        reservations:
          memory: 4G

volumes:
  ragify_data:
    driver: local

# Optional: Network for external access
# networks:
#   default:
#     name: ragify_network
